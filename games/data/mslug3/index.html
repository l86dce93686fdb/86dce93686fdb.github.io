
	<div style="width:640px;height:480px;max-width:100%">
        <div id="game"></div>
      </div>
<script type="text/javascript">
    EJS_player = '#game';
	EJS_gameID = 28096
    EJS_biosUrl = '';
    EJS_gameUrl = 'https://files4.retrogames.cc:17540/MndKa1JQzchgQx2YBtJzxfuaFHvfoRVmWpgc1iYOS1YxTmJXMjBVcHZVWFY4Q01BV0dHRWJxaVBhVUtZbVVCcUZ6RXpWSGx2THc9PQ%3D%3D/28096_dragon-ball-z-supersonic-warriors-k-projectg.zip'; // Url to Game rom
    EJS_core = 'gba'; // Optional core: vbam, vbanext


    EJS_onGameStart = function() {
        console.log('start');
        $.post('/ajax/start-game', {id:EJS_gameID, rid:0}, function(ret) {});

        if ($('.ejs--7a5f920ceffb2913f6dbda780573cf').length) {
            $('.reveal-overlay, .reveal.without-overlay').appendTo($('.ejs--7a5f920ceffb2913f6dbda780573cf'));
        }
    };
    var saving = 0;

    var URL = window.URL || window.webkitURL || window.mozURL;


    var confirm = function(title, message, callback) {
		var modal = '<div class="reveal small" id="confirmation">'+
			     		'<h2>'+title+'</h2>'+
			   		'<p class="lead">'+message+'</p>'+
         			'<button class="button small success yes">Yes</button>'+
			    		'<button class="button small alert float-right" data-close>No</button>'+
		       		'</div>';
        if ($('.ejs--7a5f920ceffb2913f6dbda780573cf').length) {
		    $('.ejs--7a5f920ceffb2913f6dbda780573cf').append(modal);
        } else {
            $(document.body).append(modal);
        }
		var confirmation = new Foundation.Reveal($('#confirmation'), {multipleOpened:true});
        
        if ($('.ejs--7a5f920ceffb2913f6dbda780573cf').length) {
            $('#confirmation').closest('.reveal-overlay').appendTo('.ejs--7a5f920ceffb2913f6dbda780573cf');
        }

		confirmation.open();
    
		$('#confirmation').children('.yes').on('click', function() {
			confirmation.close();
			$('#confirmation').remove();
      	    callback.call();
    	});
	};
    $(document).on('closed.zf.reveal', '#confirmation', function() {
        $('#confirmation').remove();
    });
    
    $(document).on('open.zf.reveal', '#confirmation', function() {
        
        if ($('.ejs--7a5f920ceffb2913f6dbda780573cf').length) {
            $('#confirmation').closest('.reveal-overlay').appendTo('.ejs--7a5f920ceffb2913f6dbda780573cf');
        }
    });

    var getStatesFromServer = function() {
        loadModal.loading();
        var data = {'id':'22026'};
                $.ajax({
            type: 'POST',
            url: '/ajax/get-states',
            data: data,
            dataType: 'json',
            success: function(ret) {
                if (ret.loggedin == 0) {

                    loadModal.find('ul.tabs li:eq(0)').trigger('click');

                    loginModal.foundation('open');
                    return false;
                }

                var states = ret['data'];
                var content = loadModal.find('.content:eq(1)').text('');
                $.each(states, function(i, state) {
                    var el = $('<div />').addClass('state-item large-3 medium-4 small-4 columns');
                    var inner = $('<div />').addClass('state-item-inner')
                        .append('<a><img data-url="'+state['url']+'" data-id="'+state['id']+'" src="'+state['screenshot']+'"></a>')
                        .append('<p>' + state['date'] + '<br /><a class="del" data-id="'+state['id']+'">Delete</a></p>');

                    el.append(inner).appendTo(content);
                });
                
                if (states.length == 0) {
                    content.html('No save state files found');
                }
                loadModal.loading('stop');
            },
            complete: function() {
                loadModal.loading('stop');
            }
        });
    };

    var saveStateToServer = function(screenshot, state) {
        var formdata = new FormData();
        formdata.append("id", '22026');
        formdata.append("screen", new Blob([screenshot], {type:"application/octet-stream"}));
        formdata.append("state_file", new Blob([state], {type:"application/octet-stream"}));
        formdata.append("old", 0);

        if (!isLoggedIn) {
            loginModal.foundation('open');
            return ;
        }

        if ($('.ejs--7a5f920ceffb2913f6dbda780573cf').length) {
            $('.save-state-process').appendTo($('.ejs--7a5f920ceffb2913f6dbda780573cf'));
        }

        var xhr = new XMLHttpRequest();
        xhr.upload.addEventListener("progress", function (evt) {
            if (evt.lengthComputable) {
                var percent = Math.round(evt.loaded * 100 / evt.total);
                $('.save-state-process').show();

                if(percent>100){
                    percent=0;
                    $('.save-state-process .circle').removeClass('clip-auto');
                    $('.save-state-process .right').addClass('wth0');
                }else if(percent>50){
                    $('.save-state-process .circle').addClass('clip-auto');
                    $('.save-state-process .right').removeClass('wth0');
                }
                $('.save-state-process .left').css("-webkit-transform","rotate("+(18/5)*percent+"deg)").css("transform","rotate("+(18/5)*percent+"deg)");
                $('.save-state-process .num>span').text(percent);

                
            } else {}
        }, false);
        xhr.addEventListener("load", function (evt) {
            var ret = JSON.parse(evt.target.responseText);


            $('.save-state-process').hide();
            if (ret.loggedin == 0) {
                loginModal.foundation('open');
            } else {
                $(self).removeClass('disabled');
                // t.reset();
                if (ret.status == 0) {
                    $.toast({
                        text: 'Failed',
                        showHideTransition: 'fade',
                        icon: 'error',
                        beforeShow: function () {
                            if ($('.ejs--7a5f920ceffb2913f6dbda780573cf').length) {
                                $('.jq-toast-wrap').appendTo($('.ejs--7a5f920ceffb2913f6dbda780573cf'));
                            }
                        }
                    });
                } else {
                    $.toast({
                        text : "Saved",
                        bgColor : 'rgba(0,0,0,0.5)',
                        textColor : '#fff',
                        allowToastClose : false,
                        hideAfter : 3000,
                        beforeShow: function () {
                            if ($('.ejs--7a5f920ceffb2913f6dbda780573cf').length) {
                                $('.jq-toast-wrap').appendTo($('.ejs--7a5f920ceffb2913f6dbda780573cf'));
                            }
                        }
                    });
                }
            }
            saving = 0;
        }, false);
        xhr.addEventListener("error", function() {
            $('.save-state-process').hide();
            $(self).removeClass('disabled');
            $.toast({
                text: 'Failed',
                showHideTransition: 'fade',
                icon: 'error',
                beforeShow: function () {
                            if ($('.ejs--7a5f920ceffb2913f6dbda780573cf').length) {
                                $('.jq-toast-wrap').appendTo($('.ejs--7a5f920ceffb2913f6dbda780573cf'));
                            }
                }
            });
            saving = 0;
        }, false);
        xhr.open("POST", "/ajax/save-state");
        xhr.send(formdata);



    };

    var saveStateToLocal = function(screenshot, state) {
        if (typeof saveAs != 'undefined') {
            saveAs(new Blob([state], {type:"application/octet-stream"}), 'game.save');
        }
    };


    EJS_onSaveState = function(data) {
        if (saving) {
            return false;
        }
        saving = 1;
        // var state = jz.zlib.compress(data.state);
        // var screenshot = data.screenshot;
        // console.log(state.length);
        var f = new Blob([data.state], {type:"application/octet-stream"});
        var fr = new FileReader();
        fr.onload = function() {
            var state = jz.zlib.compress(new Uint8Array(fr.result));
            var screenshot = data.screenshot;
            
            if (saveLocation == 'file') {
                saveStateToLocal(screenshot, state);
                saving = false;
            } else if (saveLocation == 'server') {
                saveStateToServer(screenshot, state);
            } else {
                dialogModal.foundation('open');
                dialogModal.find('h1.title').text('Save to');
                dialogModal.find('.content').html(

                    '<p><input id="state_saveto_file" checked type="radio" value="file" name="saveto" /><label class="customLabel" for="state_saveto_file"><span>File</span></label></p>'+
                    (state.length < 2.5*1024*1024 ? '<p><input id="state_saveto_server" type="radio" value="server" name="saveto" /><label class="customLabel" for="state_saveto_server"><span>Server</span></label></p>' : '') +
                    '<p><input type="checkbox" id="check_remember_saveto" name="remember_saveto" value="1" /><label for="check_remember_saveto" class="customLabel">Don\'t ask me agian</label></p>');
                dialogModal.find('.actions .submit').one('click', function() {
                    var saveto = dialogModal.find('[name=saveto]:checked').val();
                    var remember = dialogModal.find('[name=remember_saveto]:checked').val();
                    if (remember == 1) {
                        // localStorage.setItem('save_location', saveto);
                        saveLocation = saveto;
                    }
                    if (saveto == 'file') {
                        saveStateToLocal(screenshot, state);
                        saving = false;
                    } else if (saveto == 'server') {
                        saveStateToServer(screenshot, state);

                    }
                });

                dialogModal.on('closed.zf.reveal', function() {
                    saving = false;
                    dialogModal.find('.actions .submit').off('click');
                });
            }

        };
        fr.readAsArrayBuffer(f);

    };

    EJS_onLoadState = function(loadStateFn) {
        // window.loadState = this.loadState;
        window.loadState = loadStateFn;
        // window.xxxx = this;
        
        loadModal.foundation('open');
        // console.log(this, loadState);
        
    };

    
</script>
<script src="//www.emulatorjs.com/loader.js" crossorigin></script>